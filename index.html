<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>å¤©å ‚è¦‹ We will see in Heaven</title>
  <!-- css reset -->
  <link rel="stylesheet" href="css/reset.css">
  <!-- é€£çµ css æ¨£å¼ -->
  <link rel="stylesheet" href="css/goTogether.css">
</head>

<body>
  <!-- TODO 2åˆå§‹åœ–ç‰‡åŠUIä¿®æ”¹ã€1CSSåœ–ç‰‡å‹•ç•«(è¨­å®šé›£æ˜“åº¦ç”¨ç§’æ•¸æ›´æ”¹)ã€3alertã€æé†’æ¨£å¼ã€4Stopéµ *éŸ³æ¨‚æ’­æ”¾æŒ‰éˆ•-->
  <audio id="bgMusic" src="musics/AI_2.mp3" autoplay loop></audio>
  <!-- <bgsoud id="bgMusic" src="musics/AI_2.mp3" autostart=true loop=-1></bgsoud> -->
  <!-- <embed id="bgMusic" src="musics/AI_2.mp3" loop="true" autostart="true" hidden="true"> -->

  <div id="top">
    <p id="text-timeleft">30 s</p>
    <p id="text-score">Scoreï¼š0 åˆ†</p>
    <div id="picExframe">
      <table>
        <tr>
          <td class="exLeft" rowspan="2"><img class="picEx" src="images/fish.png" alt="fish">
          </td>
          <td class="exCalc red">+1åˆ†</td>
          <td class="exLeft" rowspan="2"><img class="picEx" src="images/sad-people.png" alt="sad-people">
          </td>
          <td class="exCalc red">+3åˆ†</td>
          <td class="exLeft" rowspan="2"><img class="picEx" src="images/sushi.png" alt="sushi"></td>
          <td class="exCalc red">+0åˆ†</td>
          <td class="exLeft" rowspan="2"><img class="picEx" src="images/egg.png" alt="egg"></td>
          <td class="exCalc red">+7åˆ†</td>
          <td class="exLeft" rowspan="2"><img class="picEx" src="images/red-evil.png" alt="red-evil"></td>
          <td class="exCalc">-1åˆ†</td>
          <td class="exLeft" rowspan="2"><img class="picEx" src="images/yellow-evil.png" alt="yellow-evil">
          </td>
          <td class="exCalc">-2åˆ†</td>
        </tr>
        <tr>
          <td class="exCalc red">+1ç§’</td>
          <td class="exCalc red">+0ç§’</td>
          <td class="exCalc red">+2ç§’</td>
          <td class="exCalc red">+0ç§’</td>
          <td class="exCalc">-0ç§’</td>
          <td class="exCalc">-1ç§’</td>
        </tr>
      </table>
    </div>

  </div>

  <img id="btn-left" src="images/white-wings-left.png" alt="">
  <div id="left">
    <div>
      <p class="sideP">Top9 æ’è¡Œæ¦œ</p>
      <div class="rankFrame">
        <span class="text-ranknum red">1</span>&ensp;
        <span class="text-rankplayer red">nobody</span>
        <span class="text-rankscore red">0</span>
      </div>
      <div class="rankFrame">
        <span class="text-ranknum yellow">2</span>&ensp;
        <span class="text-rankplayer yellow">nobody</span>
        <span class="text-rankscore yellow">0</span>
      </div>
      <div class="rankFrame">
        <span class="text-ranknum">3</span>&ensp;
        <span class="text-rankplayer">nobody</span>
        <span class="text-rankscore">0</span>
      </div>
      <div class="rankFrame">
        <span class="text-ranknum">4</span>&ensp;
        <span class="text-rankplayer">nobody</span>
        <span class="text-rankscore">0</span>
      </div>
      <div class="rankFrame">
        <span class="text-ranknum">5</span>&ensp;
        <span class="text-rankplayer">nobody</span>
        <span class="text-rankscore">0</span>
      </div>
      <div class="rankFrame">
        <span class="text-ranknum">6</span>&ensp;
        <span class="text-rankplayer">nobody</span>
        <span class="text-rankscore">0</span>
      </div>
      <div class="rankFrame">
        <span class="text-ranknum">7</span>&ensp;
        <span class="text-rankplayer">nobody</span>
        <span class="text-rankscore">0</span>
      </div>
      <div class="rankFrame">
        <span class="text-ranknum">8</span>&ensp;
        <span class="text-rankplayer">nobody</span>
        <span class="text-rankscore">0</span>
      </div>
      <div class="rankFrame">
        <span class="text-ranknum">9</span>&ensp;
        <span class="text-rankplayer">nobody</span>
        <span class="text-rankscore">0</span>
      </div>
    </div>
  </div>

  <img id="btn-right" src="images/white-wings-right.png" alt="">
  <div id="right">
    <p class="sideP">å·¥å…·</p>
  </div>

  <div id="middle">
    <table id="gameFrame" border="1">
      <tr>
        <td><img src="" alt="" class="hole"></td>
        <td><img src="" alt="" class="hole"></td>
        <td><img src="" alt="" class="hole"></td>
        <td><img src="" alt="" class="hole"></td>
        <td><img src="" alt="" class="hole"></td>
        <td><img src="" alt="" class="hole"></td>
        <td><img src="" alt="" class="hole"></td>
      </tr>
      <tr>
        <td><img src="" alt="" class="hole"></td>
        <td><img src="" alt="" class="hole"></td>
        <td><img src="" alt="" class="hole"></td>
        <td><img src="" alt="" class="hole"></td>
        <td><img src="" alt="" class="hole"></td>
        <td><img src="" alt="" class="hole"></td>
        <td><img src="" alt="" class="hole"></td>
      </tr>
      <tr>
        <td><img src="" alt="" class="hole"></td>
        <td><img src="" alt="" class="hole"></td>
        <td><img src="" alt="" class="hole"></td>
        <td><img src="" alt="" class="hole"></td>
        <td><img src="" alt="" class="hole"></td>
        <td><img src="" alt="" class="hole"></td>
        <td><img src="" alt="" class="hole"></td>
      </tr>
      <tr>
        <td><img src="" alt="" class="hole"></td>
        <td><img src="" alt="" class="hole"></td>
        <td><img src="" alt="" class="hole"></td>
        <td><img src="" alt="" class="hole"></td>
        <td><img src="" alt="" class="hole"></td>
        <td><img src="" alt="" class="hole"></td>
        <td><img src="" alt="" class="hole"></td>
      </tr>
      <tr>
        <td><img src="" alt="" class="hole"></td>
        <td><img src="" alt="" class="hole"></td>
        <td><img src="" alt="" class="hole"></td>
        <td><img src="" alt="" class="hole"></td>
        <td><img src="" alt="" class="hole"></td>
        <td><img src="" alt="" class="hole"></td>
        <td><img src="" alt="" class="hole"></td>
      </tr>
    </table>
  </div>

  <div id="btn-start">Go</div>

  <script src="js/jquery-3.5.0.min.js"></script>
  <script>
    // const bgMusic = document.getElementById("bgMusic");
    // bgMusic.muted = true;
    // top å‰©é¤˜æ™‚é–“ã€ç•¶å‰åˆ†æ•¸
    const textTime = document.getElementById("text-timeleft");
    const textScore = document.getElementById("text-score");

    // middle éŠæˆ²ç•«é¢ã€åœ°æ´
    const gameFrame = document.getElementById("gameFrame");
    const holes = document.getElementsByClassName("hole");
    const btnStart = document.getElementById("btn-start");

    // left
    // const textRankNum = document.getElementsByClassName("text-ranknum");
    const textRankPlayer = document.getElementsByClassName("text-rankplayer");
    const textRankScore = document.getElementsByClassName("text-rankscore");

    // éš¨æ©Ÿæ•¸ function
    const rand = (min, max) => {
      return Math.round(Math.random() * (max - min) + min);
    }

    // å·¦å³å´é»æ“Šæ”¶åˆ(ç‚ºäº†æ–¹ä¾¿å…ˆç”¨JQuery)
    $("#btn-left").click(function () {
      $("#left").slideToggle(1000);
    });
    $("#btn-right").click(function () {
      $("#right").slideToggle(1000);
    })

    // åœ–ç‰‡æ’å…¥å€
    let imgFish = "images/fish.png";
    let imgSad = "images/sad-people.png";
    let imgSushi = "images/sushi.png";
    let imgEgg = "images/egg.png";
    let imgRedEvil = "images/red-evil.png";
    let imgYellowEvil = "images/yellow-evil.png";
    // åœ–ç‰‡å‡ºç¾ç”¢ç”Ÿä¸åŒæ©Ÿç‡ç”¨
    let imgp = 0;
    // const imgs = [imgFish, imgSad, imgSushi, imgEgg, imgRedEvil, imgYellowEvil];

    // éŸ³æ•ˆå€
    const bubble = new Audio; bubble.src = "musics/bubble.mp3";
    const correct = new Audio; correct.src = "musics/correct.mp3";
    const eat = new Audio; eat.src = "musics/eat.mp3";
    const hope = new Audio; hope.src = "musics/hope.mp3";
    const warning = new Audio; warning.src = "musics/warning.mp3";
    const evilLaugh = new Audio; evilLaugh.src = "musics/evil-laugh.mp3";
    const translate = new Audio; translate.src = "musics/translate.mp3";
    const surprise = new Audio; surprise.src = "musics/surprise.mp3";
    // const bgMusic = new Audio; bgMusic.src = "musics/AI_2.mp3";
    // const bgMusic = new Audio("musics/AI_2.mp3");
    // window.loding = () => {
    //   bgMusic.play();
    // }

    // éŸ³é‡å€
    bgMusic.volume = 0.5;
    bubble.volume = 0.5;
    correct.volume = 0.5;
    eat.volume = 0.5;
    hope.volume = 0.5;
    warning.volume = 0.5;
    evilLaugh.volume = 0.5;
    translate.volume = 0.5;
    surprise.volume = 0.5;

    // éŠæˆ²è®Šæ•¸åŸºæœ¬è¨­å®šå€
    let score = 0;
    let inGame = false;
    let timeLeft = 30;
    let timer = 0;
    let gameRound = 0;
    let randJump = 0;
    let jumps = [];
    let rank = [{ name: 'nobody', score: 0 }, { name: 'nobody', score: 0 }, { name: 'nobody', score: 0 }, { name: 'nobody', score: 0 }, { name: 'nobody', score: 0 }, { name: 'nobody', score: 0 }, { name: 'nobody', score: 0 }, { name: 'nobody', score: 0 }, { name: 'nobody', score: 0 }];
    let storage = [JSON.parse(localStorage.getItem("rank0")), JSON.parse(localStorage.getItem("rank1")), JSON.parse(localStorage.getItem("rank2")), JSON.parse(localStorage.getItem("rank3")), JSON.parse(localStorage.getItem("rank4")), JSON.parse(localStorage.getItem("rank5")), JSON.parse(localStorage.getItem("rank6")), JSON.parse(localStorage.getItem("rank7")), JSON.parse(localStorage.getItem("rank8"))];
    for (let i = 0; i <= 8; i++) {
      if (storage[i] != null) {
        rank[i].score = storage[i].score;
        rank[i].name = storage[i].name;
        textRankScore[i].innerText = rank[i].score;
        textRankPlayer[i].innerText = rank[i].name;
      }
    }
    console.log(storage);

    // é»æ“Š"é–‹å§‹"
    btnStart.onclick = () => {
      // è®“btnStart æ¶ˆå¤±
      btnStart.style.display = "none";
      // é–‹å§‹éŠæˆ²
      inGame = true;
      // é‡ç½®åˆ†æ•¸ã€èµ·å§‹æ™‚é–“
      score = 0;
      textScore.innerText = `Scoreï¼š${score} åˆ†`;
      timeLeft = 30;
      textTime.innerText = `${timeLeft} s`;

      gameRound = setInterval(game, 2500);
      timer = setInterval(timeDes, 1000);
      game();
    }

    // éŠæˆ²é€²è¡Œ
    const game = () => {
      // æ¸…ç©º hole åœ–ç‰‡ã€å‹•ç•«
      for (let hole of holes) {
        hole.src = "";
        hole.style.animation = "";
      }
      // é‡ç½® jumpséš¨æ©Ÿæ ¼å­é™£åˆ—ã€imgpåœ–ç‰‡æ©Ÿç‡
      jumps = [];
      imgp = 0;

      // éš¨æ©Ÿé¸7æ ¼è·³åœ–ç‰‡
      for (let i = 0; i < 7; i++) {
        // éš¨æ©Ÿä¸é‡è¤‡
        randJump = rand(0, 34);
        while (jumps.includes(randJump)) {
          randJump = rand(0, 34);
        }
        jumps.push(randJump);

        // å·²è¢«é¸çš„éš¨æ©Ÿæ ¼å­ï¼Œå†æŒ‰"æ©Ÿç‡"é¸åœ–ç‰‡è·³å‡º (å¾1é–‹å§‹æ˜¯ç‚ºäº†è¦è®“æ©Ÿç‡å‡ç­‰1~100å€‹)
        imgp = rand(1, 100);
        // console.log(imgp);
        if (imgp > 0 && imgp <= 30) {
          // é­š 30%
          holes[jumps[i]].src = imgFish;
          holes[jumps[i]].style.animation = "hole 2.5s infinite";
        }
        else if (imgp > 30 && imgp <= 60) {
          // é›£é 30%
          holes[jumps[i]].src = imgSad;
          holes[jumps[i]].style.animation = "hole 2.5s infinite";
        }
        else if (imgp > 60 && imgp <= 67) {
          // å£½å¸ 7%
          holes[jumps[i]].src = imgSushi;
          holes[jumps[i]].style.animation = "hole 2.5s infinite";
        }
        else if (imgp > 67 && imgp <= 70) {
          // å½©è›‹ 3%
          holes[jumps[i]].src = imgEgg;
          holes[jumps[i]].style.animation = "hole 2.5s infinite";
        }
        else if (imgp > 70 && imgp <= 85) {
          // ç´…æƒ¡ 15%
          holes[jumps[i]].src = imgRedEvil;
          holes[jumps[i]].style.animation = "hole 2.5s infinite";
        }
        else if (imgp > 85 && imgp <= 100) {
          // é»ƒæƒ¡ 15%
          holes[jumps[i]].src = imgYellowEvil;
          holes[jumps[i]].style.animation = "hole 2.5s infinite";
        }
      }
    }

    // æ™‚é–“ç·šæ§åˆ¶
    const timeDes = () => {
      // éæ¸›æ™‚é–“
      timeLeft--;
      textTime.innerText = `${timeLeft} s`;

      // éŠæˆ²çµæŸæ™‚
      if (timeLeft <= 0) {
        inGame = false;
        clearInterval(timer);
        clearInterval(gameRound);
        // æ¸…ç©ºåœ–ç‰‡ã€å‹•ç•«
        for (let hole of holes) {
          hole.src = "";
          hole.style.animation = "";
        }

        // setTimeout ç‚ºäº†è®“ç§’æ•¸è·‘åˆ° 0s
        setTimeout(() => {
          // TODO æŠŠalertè¨­å®šæ”¹å¥½çœ‹ ç”¨divè·³
          alert(`ä½ ç²å¾—äº† ${score} åˆ†`);

          // TODO é€²å…¥æ’è¡Œæ¦œ(åˆ†æ•¸å¤§æ–¼ç¬¬9åæ‰æœƒé€²æ¦œï¼ŒåŒåˆ†ä¸æœƒé€²)
          // é€²æ¦œå°è©±æ¡†
          if (storage[8] == null || score > rank[8].score) {
            // TODO whyéŸ³æ•ˆè¼¸å…¥å®Œæ‰æœƒå‡ºç¾?
            hope.play();
            const input = prompt("å¤ªæ£’äº† ï½ æ­å–œä½ é€²å…¥å‰ Top 9 ï¼ğŸ\nè«‹å¯«ä¸‹ä½ çš„åå­—ï¼Œå› ä½ æ˜¯å°Šè²´çš„å‹‡è€… ğŸ¤´ğŸ‘¸\n(ä¸­æ–‡5å­—ä»¥å…§ï¼Œè‹±æ–‡7å­—ä»¥å…§)");
            // æœ‰ç•™åå­—æ‰æœƒåŠ é€²æ’è¡Œæ¦œ
            if (input != null || input.trim() !== '') {
              // æ’è¡Œæ¯”è¼ƒ
              for (let i = 0; i <= 8; i++) {
                if (score > rank[i].score) {
                  // å…ˆå°‡ä½æ–¼æ­¤å€¼çš„äººæ’åä¸‹é™
                  for (let j = 7; j >= i; j--) {
                    // ä¸‹å€‹æ’åå€¼ = åŸæœ¬åå€¼
                    rank[j + 1].score = rank[j].score;
                    rank[j + 1].name = rank[j].name;
                    textRankScore[j + 1].innerText = rank[j + 1].score;
                    textRankPlayer[j + 1].innerText = rank[j + 1].name;
                    localStorage.setItem(`rank${j + 1}`, JSON.stringify(rank[j + 1]));
                  }

                  // å°‡æœ¬æ¬¡å€¼æ”¾é€²è©²æ’è¡Œ
                  rank[i].score = score;
                  rank[i].name = input;
                  textRankScore[i].innerText = rank[i].score;
                  textRankPlayer[i].innerText = rank[i].name;
                  localStorage.setItem(`rank${i}`, JSON.stringify(rank[i]));
                  break;
                }
                else if (score == rank[i].score) {
                  // å…ˆå°‡ä½æ–¼æ­¤å€¼çš„äººæ’åä¸‹é™
                  for (let k = 7; k >= i; k--) {
                    // ä¸‹å€‹æ’åå€¼ = åŸæœ¬åå€¼
                    rank[k + 1].score = rank[k].score;
                    rank[k + 1].name = rank[k].name;
                    textRankScore[k + 1].innerText = rank[k + 1].score;
                    textRankPlayer[k + 1].innerText = rank[k + 1].name;
                    localStorage.setItem(`rank${k + 1}`, JSON.stringify(rank[k + 1]));
                  }

                  // å°‡æœ¬æ¬¡å€¼æ”¾é€²è©²æ’è¡Œ
                  rank[i].score = score;
                  rank[i].name = input;
                  textRankScore[i].innerText = rank[i].score;
                  textRankPlayer[i].innerText = rank[i].name;
                  localStorage.setItem(`rank${i}`, JSON.stringify(rank[i]));
                  break;
                }
              }

            }
          }
          else if (score == rank[8].score) {
            translate.play();
            alert("å°Šè²´çš„å‹‡å£«ï¼Œä½ é›–èˆ‡ç¬¬9ååŒåˆ†ï¼Œä½†å°šé‚„ä¸èƒ½é€²æ¦œï¼Œè«‹ç¹¼çºŒå …æŒå‘€ ~ çªç ´è‡ªå·±ğŸ’ª");
          }
          else if (score < rank[8].score) {
            surprise.play();
            alert("åŠ æ²¹å•Š~è®“æˆ‘å€‘åŠªåŠ›å¥”è‘—ç›®æ¨™å‘å‰ ğŸ”¥");
          }

          // è®“ btn å‡ºç¾ï¼ŒåŸæœ¬cssè¨­flexï¼Œæ‰€ä»¥é€™è£¡ä¹Ÿè¦èª¿å›flexï¼Œä¸ç„¶æœƒè·‘ç‰ˆ
          btnStart.style.display = "flex";

          // è®“å‰©é¤˜æ™‚é–“èª¿å›ä¾†
          timeLeft = 30;
          textTime.innerText = `${timeLeft} s`;

          // TODO å›åˆ°åˆå§‹åœ–ç‰‡ (htmlä¹Ÿè¦åŠ åˆå§‹åœ–ç‰‡gif or svg)
        }, 80);
      }
    }

    // éŠæˆ²é»æ“Šäº‹ä»¶&åˆ†æ•¸ã€æ™‚é–“
    // TODO è¢«é»æ“Šæ™‚æ›åœ–ç‰‡ã€éŸ³æ•ˆ
    for (let hole of holes) {
      hole.onmousedown = () => {
        // é­š +1åˆ† +1ç§’
        if (inGame && hole.src.includes(imgFish)) {
          hole.src = "images/translate/fish-love.png";
          bubble.play();
          score++;
          textScore.innerText = `Scoreï¼š${score} åˆ†`;
          timeLeft++;
          textTime.innerText = `${timeLeft} s`;
        }
        // é›£é +3åˆ†
        else if (inGame && hole.src.includes(imgSad)) {
          hole.src = "images/translate/love-people.png";
          correct.play();
          score += 3;
          textScore.innerText = `Scoreï¼š${score} åˆ†`;
        }
        // å£½å¸ +2ç§’
        else if (inGame && hole.src.includes(imgSushi)) {
          hole.src = "images/translate/sushi-eatten.png";
          eat.play();
          timeLeft += 2;
          textTime.innerText = `${timeLeft} s`;
        }
        // å½©è›‹ +5åˆ†
        else if (inGame && hole.src.includes(imgEgg)) {
          hole.src = "images/translate/egg-love.png";
          hope.play();
          score += 7;
          textScore.innerText = `Scoreï¼š${score} åˆ†`;
        }
        // ç´…æƒ¡ -1åˆ†
        else if (inGame && hole.src.includes(imgRedEvil)) {
          // TODO ç¶²å­è®Šå¤§çš„å‹•ç•«ã€è¨­å®šç§’æ•¸ã€é‚„åŸ
          hole.src = "images/translate/net.png";
          hole.style.animation = "net 2.5s";
          warning.play();
          score--;
          textScore.innerText = `Scoreï¼š${score} åˆ†`;
        }
        // é»ƒæƒ¡ -2åˆ† -1ç§’
        else if (inGame && hole.src.includes(imgYellowEvil)) {
          hole.src = "images/translate/yellow-evil-black-love.png";
          evilLaugh.play();
          score -= 2;
          textScore.innerText = `Scoreï¼š${score} åˆ†`;
          timeLeft--;
          textTime.innerText = `${timeLeft} s`;
        }
      }
    }

  // TODO éŠæˆ²ä¸­éµç›¤å¯ä»¥ä½¿ç”¨ ï½“ ç•¶ä½œæ»‘é¼ é»æ“Š
  // document.onkeydown = (event) => {
  //     const key = event.key;
  //     if (key == "s") {
  //         const screen = document.getElementsByTagName("body");
  //         screen.onmousedown();
  //     }
  // }
  </script>

</body>

</html>